# ===================================================================
# Unified Backend Requirements for Ktiseos-Nyx Trainer
#
# This file consolidates dependencies from the vendored backend and
# establishes a single source of truth for the environment.
# ===================================================================

# -- Critical Safety Pins (based on Qwen analysis and known breakages) --
# Pinned to avoid breaking changes in Kohya sd-scripts
numpy==1.26.4
# Pinned to avoid version hell between ONNX, WandB, and safetensors
protobuf==3.20.3


# -- Core Training Dependencies --
# Note: torch, torchvision, and torchaudio must be installed separately
# based on the detected GPU environment (CUDA, ROCm, etc.)
accelerate==0.33.0
transformers==4.54.1
diffusers[torch]==0.32.1
safetensors==0.5.3
bitsandbytes==0.45.5
torch-fidelity==0.3.0
einops==0.8.1
lycoris-lora

# -- Optimizers & Schedulers --
prodigyopt==1.1.2
lion-pytorch==0.2.3
dadaptation==3.2
pytorch_optimizer==3.1.2
schedulefree==1.4
prodigy-plus-schedule-free
came-pytorch

# -- General Utilities --
toml==0.10.2
tqdm==4.66.4
rich==14.1.0
ftfy==6.2.0
requests>=2.28.0
psutil
pyyaml
pandas
scipy
omegaconf
huggingface-hub==0.34.3
fiftyone
gallery-dl
hf-transfer
voluptuous==0.15.2
sentencepiece==0.2.1
uv  # Ultra-fast Python package installer

# -- API & Web Server --
starlette
uvicorn[standard]
pyngrok
pycloudflared

# -- Image/UI/Data Handling --
# Pillow>=10.3.0 required for security fixes
Pillow>=10.3.0
opencv-python==4.10.0.84
imageio==2.34.1
imageio-ffmpeg==0.5.1
pyarrow==16.1.0
altair==5.3.0
streamlit==1.35.0
easygui==0.98.3
Jinja2==3.1.4
sidecar>=0.5.0
ipywidgets>=8.0.0
ipython>=8.0.0
imagesize==1.4.1
setuptools==78.1.0

# -- Monitoring & Logging --
tensorboard==2.16.2
wandb==0.17.0
watchdog==4.0.0

# -- ONNX / Tagger Dependencies --
onnx==1.16.1
# Use Microsoft's CUDA 12 build instead of broken PyPI version
onnxruntime-gpu==1.17.1 --extra-index-url https://aiinfra.pkgs.visualstudio.com/PublicPackages/_packaging/onnxruntime-cuda-12/pypi/simple/

# -- Windows Specific (safe to include for all OS) --
pyreadline
colorama